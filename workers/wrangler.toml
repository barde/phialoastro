name = "phialo-design"
main = "src/index.ts"
compatibility_date = "2024-09-25"
compatibility_flags = ["nodejs_compat", "brotli_content_encoding"]
workers_dev = true

[assets]
directory = "../phialo-design/dist"
binding = "ASSETS"

[build]
command = "npm run build"
cwd = "../phialo-design"

# Preview environment for branch deployments
[env.preview]
name = "phialo-design-preview"
workers_dev = true
compatibility_flags = ["nodejs_compat", "brotli_content_encoding"]

[env.preview.vars]
ENVIRONMENT = "preview"

# Analytics Engine binding for Web Vitals
[[env.preview.analytics_engine_datasets]]
binding = "VITALS_ANALYTICS"

# Production environment
[env.production]
name = "phialo"
# Enable custom domain routing
route = { pattern = "phialo.de/*", zone_name = "phialo.de" }
workers_dev = false
compatibility_flags = ["nodejs_compat", "brotli_content_encoding"]

[env.production.vars]
ENVIRONMENT = "production"

# Analytics Engine binding for Web Vitals
[[env.production.analytics_engine_datasets]]
binding = "VITALS_ANALYTICS"

[vars]
ENVIRONMENT = "development"

# Email service configuration
# Resend:
# - wrangler secret put RESEND_API_KEY
# Reply-to email (optional, defaults to FROM_EMAIL if not set):
# - wrangler secret put REPLY_TO_EMAIL
# Turnstile CAPTCHA (optional):
# - wrangler secret put TURNSTILE_SECRET_KEY

# Test environment for running tests
[env.test]
name = "phialo-design-test"
workers_dev = true
main = "src/index.ts" # Use modular implementation
compatibility_flags = ["nodejs_compat", "brotli_content_encoding"]

[env.test.vars]
ENVIRONMENT = "test"