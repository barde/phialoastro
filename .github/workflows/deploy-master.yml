# Master Branch Deployment Workflow
# 
# This workflow calls the reusable deployment workflow for the master branch.
# It deploys the latest master branch code to the staging environment
# for final testing before production release.

name: ðŸš€ Deploy Master Branch

on:
  push:
    branches: [master]
    paths:
      - 'phialo-design/**'
      - 'workers/**'
      - '!phialo-design/**.md'
      - '!phialo-design/docs/**'
      - '!workers/**.md'
      - '!.github/**.md'
  workflow_dispatch:
    inputs:
      force-deploy:
        description: 'Force deployment even without changes'
        required: false
        type: boolean
        default: false

permissions:
  contents: read
  deployments: write
  statuses: write

concurrency:
  group: deploy-master
  cancel-in-progress: true

jobs:
  deploy-master:
    name: Deploy to Master Environment
    uses: ./.github/workflows/deploy-reusable.yml
    with:
      environment: master
      worker-name: phialo-master
      deployment-url: https://phialo-master.meise.workers.dev
      analytics-enabled: true
      cache-version: v1-master
      enable-performance-comment: false
      enable-concurrency: true
    secrets: inherit