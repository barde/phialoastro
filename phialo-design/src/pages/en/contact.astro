---
import PageLayout from '../../layouts/PageLayout.astro';
import AnimatedText from '../../components/common/AnimatedText.tsx';
import Button from '../../components/common/Button.astro';

// Web3Forms access key - in production, use environment variable
const WEB3FORMS_ACCESS_KEY = import.meta.env.WEB3FORMS_ACCESS_KEY || 'YOUR_ACCESS_KEY_HERE';

// Check if access key is properly configured
const isAccessKeyConfigured = WEB3FORMS_ACCESS_KEY && WEB3FORMS_ACCESS_KEY !== 'YOUR_ACCESS_KEY_HERE';
---

<PageLayout title="Contact - Gesa Pickbrenner | Phialo Design" description="Contact Gesa Pickbrenner for your 3D Design projects, jewelry design or Blender tutorials.">
  <section class="py-24 bg-white">
    <div class="container mx-auto px-6 md:px-8 max-w-6xl">
      <!-- Title -->
      <div class="text-center mb-16">
        <AnimatedText client:visible>
          <h1 class="font-display text-4xl md:text-5xl font-medium text-midnight mb-6">
            Contact Me
          </h1>
        </AnimatedText>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
        <!-- Contact Form on the left -->
        <div class="space-y-6 px-5 md:px-0">
          <form id="contactForm" class="space-y-6">
            <input type="hidden" name="access_key" value={WEB3FORMS_ACCESS_KEY} />
            <!-- Warning message if access key not configured -->
            {!isAccessKeyConfigured && (
              <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-yellow-800 text-sm font-medium">
                  ⚠️ Contact form not configured
                </p>
                <p class="text-yellow-700 text-sm mt-1">
                  Web3Forms access key is missing. Please set <code class="bg-yellow-100 px-1 py-0.5 rounded">WEB3FORMS_ACCESS_KEY</code> in your .env file.
                </p>
              </div>
            )}
            <input type="hidden" name="subject" value="New Contact Request - Phialo Design" />
            <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                Name *
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent transition-colors"
                placeholder="Your Name"
              />
            </div>

            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                Email *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent transition-colors"
                placeholder="your.email@example.com"
              />
            </div>

            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                Phone
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent transition-colors"
                placeholder="Your phone number"
              />
            </div>

            <div>
              <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                Message *
              </label>
              <textarea
                id="message"
                name="message"
                rows="5"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent transition-colors resize-none"
                placeholder="Describe your project or inquiry..."
              ></textarea>
            </div>

            <Button 
              type="submit" 
              variant="primary" 
              size="lg" 
              class="w-full"
              id="submit-button"
            >
              Send Message
            </Button>
            
            <div id="form-result" class="mt-4 text-center"></div>
          </form>

          <!-- Contact info below form -->
          <div class="mt-8 pt-8 border-t border-gray-200">
            <div class="space-y-4">
              <div class="flex items-center space-x-3">
                <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <a href="mailto:kontakt@phialo.de" class="text-midnight hover:text-gold transition-colors">
                  kontakt@phialo.de
                </a>
              </div>
              <div class="flex items-center space-x-3">
                <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <a href="tel:+4915785664700" class="text-midnight hover:text-gold transition-colors">
                  (+49) 1578 566 47 00
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Image on the right -->
        <div class="relative px-5 md:px-0">
          <img 
            src="/gesa-portrait.jpg" 
            alt="Gesa Pickbrenner"
            class="w-full h-auto rounded-lg shadow-xl"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-midnight/10 to-transparent rounded-lg pointer-events-none"></div>
        </div>
      </div>
    </div>
  </section>
</PageLayout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contactForm');
    const result = document.getElementById('form-result');
    const submitButton = document.getElementById('submit-button');
    
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Disable submit button and show loading state
        submitButton.disabled = true;
        submitButton.textContent = 'Sending...';
        result.innerHTML = '';
        result.className = 'mt-4 text-center';
        
        try {
          const formData = new FormData(form);
          const object = Object.fromEntries(formData);
          const json = JSON.stringify(object);
          
          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: json
          });
          
          const data = await response.json();
          
          if (response.status === 200) {
            result.innerHTML = '✓ Thank you! Your message has been sent successfully.';
            result.className = 'mt-4 text-center text-green-600 font-medium';
            form.reset();
          } else {
            console.error('Web3Forms Error:', data);
            
            // Provide specific error messages based on status code
            let errorMessage = 'Something went wrong. Please try again.';
            
            if (response.status === 400) {
              // Check for specific error messages from Web3Forms
              if (data.message && data.message.includes('Invalid access')) {
                errorMessage = 'Configuration error: Invalid Web3Forms access key. Please contact the administrator.';
              } else if (data.message && data.message.includes('required')) {
                errorMessage = 'Please fill in all required fields.';
              } else {
                errorMessage = data.message || 'Invalid request. Please check your input.';
              }
            } else if (response.status === 500) {
              errorMessage = 'Server error: Unable to send form at this time. Please try again later or contact us directly via email.';
            }
            
            result.innerHTML = errorMessage;
            result.className = 'mt-4 text-center text-red-600';
          }
        } catch (error) {
          console.error('Error:', error);
          result.innerHTML = 'Something went wrong. Please try again or contact us directly via email.';
          result.className = 'mt-4 text-center text-red-600';
        } finally {
          // Re-enable submit button
          submitButton.disabled = false;
          submitButton.textContent = 'Send Message';
        }
      });
    }
  });
</script>
