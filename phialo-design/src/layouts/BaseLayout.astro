---
import { SEO } from "astro-seo";
import { ViewTransitions } from "astro:transitions";
import SmoothScroll from '../components/common/SmoothScroll';
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  lang?: string;
}

const {
  title,
  description = "Phialo Design - Wo Schmuck auf Innovation trifft. 3D Design, individuelle Kreationen und Expertise in der Schmuckherstellung.",
  image = "/social/og-default.jpg",
  noindex = false,
  lang = "de"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImageURL = new URL(image, Astro.url).href;
---

<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Preload critical fonts -->
    <link rel="preload" href="/fonts/playfair-display-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/inter-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    
    <SEO
      title={title}
      description={description}
      canonical={canonicalURL}
      noindex={noindex}
      openGraph={{
        basic: {
          title: title,
          type: "website",
          image: socialImageURL,
        },
        optional: {
          description: description,
          siteName: "Phialo Design",
        },
      }}
      twitter={{
        creator: "@phialodesign",
        site: "@phialodesign",
        card: "summary_large_image",
      }}
      extend={{
        link: [
          { rel: "icon", href: "/favicon.ico" },
          { rel: "apple-touch-icon", sizes: "180x180", href: "/apple-touch-icon.png" }
        ],
        meta: [
          { name: "twitter:image", content: socialImageURL },
          { name: "twitter:title", content: title },
          { name: "twitter:description", content: description },
          { name: "theme-color", content: "#0A192F" },
        ],
      }}
    />
    
    <ViewTransitions />
  </head>  <body class="min-h-screen bg-white text-charcoal antialiased">
    <SmoothScroll client:load />
    <slot />
    
    <!-- Analytics placeholder -->
    <!-- <script is:inline src="/scripts/analytics.js"></script> -->
    
    <!-- Performance hints -->
    <script>
      // Preload important resources on interaction
      const preloadOnHover = () => {
        const links = document.querySelectorAll('a[href^="/"]');
        links.forEach(link => {
          link.addEventListener('mouseenter', () => {
            const href = link.getAttribute('href');
            if (href && !document.querySelector(`link[rel="prefetch"][href="${href}"]`)) {
              const prefetchLink = document.createElement('link');
              prefetchLink.rel = 'prefetch';
              prefetchLink.href = href;
              document.head.appendChild(prefetchLink);
            }
          }, { once: true });
        });
      };
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', preloadOnHover);
      } else {
        preloadOnHover();
      }
    </script>
  </body>
</html>
