---
import Navigation from './Navigation';

export interface Props {
  transparent?: boolean;
}

const { transparent = false } = Astro.props;
---

<header 
  id="main-header" 
  class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${
    transparent ? 'bg-transparent' : ''
  }`}
  style={!transparent ? {
    backgroundColor: 'rgba(var(--color-bg-primary-rgb, 255, 255, 255), 0.95)',
    backdropFilter: 'blur(12px)',
    borderBottom: '1px solid var(--color-gray-200)'
  } : {}}
>
  <div class="container mx-auto px-6">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a 
        href="/" 
        class="font-display text-2xl font-medium transition-colors"
        style="color: var(--color-text-primary);"
        onmouseover="this.style.color='var(--color-secondary)'"
        onmouseout="this.style.color='var(--color-text-primary)'"
        aria-label="Phialo Design Startseite"
      >
        PHIALO
      </a>
      
      <!-- Desktop Navigation -->
      <Navigation client:load />
      
      <!-- CTA Button -->
      <a 
        href="/contact" 
        class="hidden lg:inline-flex items-center px-6 py-2 text-sm font-medium rounded-full transition-all duration-200"
        style="color: var(--color-secondary); border: 1px solid var(--color-secondary);"
        onmouseover="this.style.backgroundColor='var(--color-secondary)'; this.style.color='var(--color-text-light)';"
        onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--color-secondary)';"
      >
        Projekt anfragen
      </a>
    </div>
  </div>
</header>

<script>
  // Header scroll behavior
  function initHeaderScroll() {
    const header = document.getElementById('main-header');
    if (!header) return;
    
    let lastScrollY = 0;
    let isVisible = true;
    
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      
      // Add background on scroll
      if (currentScrollY > 50) {
        header.style.backgroundColor = 'rgba(var(--color-bg-primary-rgb), 0.95)';
        header.style.backdropFilter = 'blur(12px)';
        header.style.borderBottom = '1px solid var(--color-gray-200)';
      } else if (header.dataset.transparent === 'true') {
        header.style.backgroundColor = 'transparent';
        header.style.backdropFilter = 'none';
        header.style.borderBottom = 'none';
      }
      
      // Hide/show header on scroll direction
      if (currentScrollY > lastScrollY && currentScrollY > 100 && isVisible) {
        // Scrolling down
        header.style.transform = 'translateY(-100%)';
        isVisible = false;
      } else if (currentScrollY < lastScrollY && !isVisible) {
        // Scrolling up
        header.style.transform = 'translateY(0)';
        isVisible = true;
      }
      
      lastScrollY = currentScrollY;
    };
    
    // Throttle scroll events
    let ticking = false;
    const throttledHandleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    window.addEventListener('scroll', throttledHandleScroll, { passive: true });
  }
  
  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeaderScroll);
  } else {
    initHeaderScroll();
  }
  
  // Re-initialize on page transitions (Astro ViewTransitions)
  document.addEventListener('astro:page-load', initHeaderScroll);
</script>

<style>
  header {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>
